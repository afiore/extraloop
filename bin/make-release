#! /usr/bin/env ruby

require 'fileutils'

basedir = File.realpath(File.dirname(File.dirname(__FILE__)))

# clean up all previous builds
Dir['*.gem'].each { |file| FileUtils.rm(file) }

load "#{basedir}/lib/extraloop.rb"
version = ExtraLoop::VERSION

puts "Trying to build gem for ExtraLoop v#{version}"
$stderr.puts `gem build #{basedir + "/extraloop.gemspec"}`

puts "Tagging release"
$stderr.puts `git tag v#{version} -m 'version  #{version}'`

puts "pushing tag to origin"
$stderr.puts `git push --tags`

puts "Pushing new release to rubygems.org"
$stderr.puts `gem push #{basedir + "/extraloop-#{version}.gem"}`
